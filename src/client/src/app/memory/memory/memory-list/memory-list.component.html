

<mat-card class="mat-elevation-z0 cardx">
    <div class="loading-shade" *ngIf="isLoadingResults || isRateLimitReached">
        <mat-spinner *ngIf="isLoadingResults">Loading..</mat-spinner> 
    </div>

    <mat-card-header class="card-header ">
       
        <div fxLayout="row" fxLayout.lt-md="column" fxFlex="100">
            <div   fxFlex="80">
                <mat-card-title> Memories</mat-card-title>
                <mat-card-subtitle style="margin-bottom: 8px;">No need to keep it in mind!</mat-card-subtitle>
            </div>
            <div fxFlex.lt-md="100" fxFlex="20" fxLayout="column" fx-flex fx-layout-align="end" fxHide.lt-lg
                style="align-items: end;">
                <button mat-icon-button (click)="openSearch( '3000ms', '1500ms')" class="actions">
                    <mat-icon>sort</mat-icon>
                </button>
            </div>
        </div>
    </mat-card-header>
    
    <mat-card-content class="card-content "> 

        <div class=" " fxLayout="row" fxFlexFill> 

            <div fxFlex.lt-md="100" fxFlex="100"> 
                <div class="  " fxLayout="column" fxLayout.gt-md="row">
                    
                    <div fxFlex.lt-md="100" fxFlex="100" fxHide.gt-md>
                        <app-memory-card-list [memories]="data" [displayedColumns]="displayedColumns" [searchText]="searchText" [sort]="sort">
                        </app-memory-card-list>
                    </div>
                    <div class="table-container" fxFlex="100">
                        <table fxHide.lt-lg mat-table [dataSource]="data" matSort [matSortActive]="sort? sort.active : 'title'" [matSortDirection]="sort? sort.direction : 'asc'"
                            matSortDirection="asc">
                            <!-- title -->
                            <ng-container matColumnDef="title">
                                <th mat-header-cell *matHeaderCellDef mat-sort-header
                                    sortActionDescription="Sort by title">
                                    {{'title'}}
                                </th>
                                <td mat-cell *matCellDef="let memory">
                                    <span>{{memory.title}}</span>
                                </td>
                            </ng-container>

                            <!-- organization -->
                            <ng-container matColumnDef="organization">
                                <th mat-header-cell *matHeaderCellDef 
                                    sortActionDescription="Sort by organization">
                                    {{'organization'}}</th>
                                <td mat-cell *matCellDef="let memory">
                                    <span>{{memory.organization.title}}</span>
                                </td>
                            </ng-container>
                            <!-- memoryType -->
                            <ng-container matColumnDef="memoryType">
                                <th mat-header-cell *matHeaderCellDef 
                                    sortActionDescription="Sort by memoryType">
                                    {{'memory type'}}</th>
                                <td mat-cell *matCellDef="let memory">
                                    <span>{{memory.memoryType.title}}</span>
                                </td>
                            </ng-container>

                            <!-- memoryType -->
                            <ng-container matColumnDef="environmentType">
                                <th mat-header-cell *matHeaderCellDef 
                                    sortActionDescription="Sort by environmentType"> {{'environment type'}}</th>
                                <td mat-cell *matCellDef="let memory">
                                    <span>{{memory.environmentType?.title}}</span>
                                </td>
                            </ng-container>

                            <!-- userName -->
                            <ng-container matColumnDef="userName">
                                <th mat-header-cell *matHeaderCellDef mat-sort-header
                                    sortActionDescription="Sort by userName">
                                    {{'user name'}}</th>
                                <td mat-cell *matCellDef="let memory">
                                    <span *ngIf="!memory.isUserNameSecure">{{memory.userName}}</span>
                                    <button *ngIf="memory.isUserNameSecure" mat-icon-button color="primary"
                                        aria-label="View memory"
                                        (click)="openDialog(memory.id, 'read', '3000ms', '1500ms')" [title]="'See'">
                                        <mat-icon>lock_open</mat-icon>
                                    </button>
                                </td>
                            </ng-container>
                            <!-- email -->
                            <ng-container matColumnDef="email">
                                <th mat-header-cell *matHeaderCellDef mat-sort-header
                                    sortActionDescription="Sort by email">
                                    {{'email'}}</th>
                                <td mat-cell *matCellDef="let memory">
                                    <span *ngIf="!memory.isUEmailSecure">{{memory.email}}</span>
                                    <button *ngIf="memory.isUEmailSecure" mat-icon-button color="primary"
                                        aria-label="View memory"
                                        (click)="openDialog(memory.id,  'read','3000ms', '1500ms')" [title]="'See'">
                                        <mat-icon>lock_open</mat-icon>
                                    </button>
                                </td>
                            </ng-container>
                            <!-- hostOrIpAddress -->
                            <ng-container matColumnDef="hostOrIpAddress">
                                <th mat-header-cell *matHeaderCellDef mat-sort-header
                                    sortActionDescription="Sort by hostOrIpAddress"> {{'host name/ip address'}}</th>
                                <td mat-cell *matCellDef="let memory">
                                    <span *ngIf="!memory.isHostOrIpAddressSecure">{{memory.hostOrIpAddress}}</span>
                                    <button *ngIf="memory.isHostOrIpAddressSecure" mat-icon-button color="primary"
                                        aria-label="View memory"
                                        (click)="openDialog(memory.id,  'read','3000ms', '1500ms')" [title]="'See'">
                                        <mat-icon>lock_open</mat-icon>
                                    </button>
                                </td>
                            </ng-container>
                            <!-- port -->
                            <ng-container matColumnDef="port">
                                <th mat-header-cell *matHeaderCellDef mat-sort-header
                                    sortActionDescription="Sort by port">
                                    {{'port'}}</th>
                                <td mat-cell *matCellDef="let memory">
                                    <span *ngIf="!memory.isPortSecure">{{memory.port}}</span>
                                    <button *ngIf="memory.isPortSecure" mat-icon-button color="primary"
                                        aria-label="View memory"
                                        (click)="openDialog(memory.id,  'read','3000ms', '1500ms')" [title]="'See'">
                                        <mat-icon>lock_open</mat-icon>
                                    </button>
                                </td>
                            </ng-container>
                            <!-- password -->
                            <ng-container matColumnDef="password">
                                <th mat-header-cell *matHeaderCellDef mat-sort-header
                                    sortActionDescription="Sort by password">
                                    {{'password'}}</th>
                                <td mat-cell *matCellDef="let memory">
                                    <button mat-icon-button color="primary" aria-label="View memory"
                                        (click)="openDialog(memory.id,  'read','3000ms', '1500ms')" [title]="'See'">
                                        <mat-icon>lock_open</mat-icon>
                                    </button>
                                </td>
                            </ng-container>

                            <!-- description -->
                            <ng-container matColumnDef="description">
                                <th mat-header-cell *matHeaderCellDef  
                                    sortActionDescription="Sort by description">
                                    {{'description'}}</th>
                                <td mat-cell *matCellDef="let memory">
                                    <span>{{memory.description}}</span>
                                </td>
                            </ng-container>

                            <!-- Action -->
                            <ng-container matColumnDef="action">
                                <th mat-header-cell *matHeaderCellDef>
                                    <div align="end">
                                        <button mat-raised-button aria-label="Add memory"
                                            [routerLink]="['/memories/add']" class="add-button" [title]="'Add'">
                                            <mat-icon>add </mat-icon>Add
                                        </button>
                                    </div>

                                </th>
                                <td mat-cell *matCellDef="let memory">
                                    <section>
                                        <div class="button-row" align="end">
                                            <button mat-button mat-raised-button [matMenuTriggerFor]="beforeMenu"
                                                class="actions">
                                                <mat-icon>more_horiz</mat-icon>
                                            </button>
                                            <mat-menu #beforeMenu="matMenu" xPosition="before" style="padding: 10px;">
                                                <button mat-menu-item>
                                                    <button mat-raised-button aria-label="View memory"
                                                        (click)="openDialog(memory.id,  'edit','3000ms', '1500ms')"
                                                        [title]="'Edit'">
                                                        <mat-icon color="primary">edit</mat-icon>Edit
                                                    </button>
                                                </button>
                                                <button mat-menu-item>
                                                    <button mat-raised-button aria-label="View memory" fxFlex="100"
                                                        (click)="openDialog(memory.id, 'read', '3000ms', '1500ms')"
                                                        [title]="'Read'">
                                                        <mat-icon color="primary">remove_red_eye</mat-icon>Read
                                                    </button>
                                                </button>
                                                <button mat-menu-item>
                                                    <button mat-raised-button aria-label="View history" fxFlex="100"
                                                        (click)="openDialog(memory.id, 'history', '3000ms', '1500ms')"
                                                        [title]="'History'">
                                                        <mat-icon color="primary">history</mat-icon>History
                                                    </button>
                                                </button>
                                            </mat-menu>

                                        </div>
                                    </section>

                                </td>
                            </ng-container>
                            <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
                            <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
                        </table>
                        
                    </div> 
                </div>
            </div>

        </div>
        <div class="rate-limit-reached" *ngIf="data.length<= 0" fxLayout="row" fxLayout.gt-md="row" >
            No Records found
        </div>
        <mat-paginator class="mat-paginator-sticky" [length]="resultsLength" [pageSizeOptions]="[   10, 20, 100]"
            showFirstLastButtons aria-label="Select page">
        </mat-paginator>
    </mat-card-content>
    
</mat-card>